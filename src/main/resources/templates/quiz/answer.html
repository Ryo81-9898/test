<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>選択結果</title>
	<link rel="stylesheet" th:href="@{/css/style.css}" />
	<link rel="stylesheet" th:href="@{/css/answer.css}" />

	<!-- zen-maru-gothic-regular -->
	<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap" rel="stylesheet">

	<!-- 外部JSファイルの読み込み -->
	<script th:src="@{/js/answer.js}" defer></script>
	<script th:src="@{/js/style.js}" defer></script>
	<!-- Font Awesome CDN 読み込み -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
	<!-- ✅ 共通のヘッダーを読み込む -->
	<div th:replace="fragments/header :: commonHeader"></div>

	<main class="zen-maru-gothic-regular">
		<div class="result-wrapper">
			<p id="display-time" style="display: none;"></p>

			<div class="result-bg-wrapper">
				<svg class="blob-bg" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
					<!--	葉っぱ感のある形 & 影-->
					<filter id="leafShadow" x="-20%" y="-20%" width="140%" height="140%">
						<feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="rgba(0,0,0,0.2)" />
					</filter>
					<path d="M200,220 Q400,30 600,180 Q400,370 200,220 Z" fill="white" filter="url(#leafShadow)" />
				</svg>
				<h1 class="result-text">
					あなたの正答率<br>
					<span class="rate-number">[[${correctRate}]]%</span>でした
				</h1>
			</div>
		</div>
<!--		解答カードの繰り返し-->
		<div th:each="result, s : ${userResults}"
			th:class="'result-card ' + (${result.match} ? 'correct-card' : 'incorrect-card')"
			th:style="'animation-delay: ' + (${s.count} * 0.2) + 's;'">

<!--		正解、不正解の表示-->
			<div class="result-icon">
				<span th:text="${result.match} ? '○' : '×'"></span>
			</div>
<!--		解答カードの内容-->
			<div class="result-content">
				<p class="question">問題[[${s.count}]]</p>
				<p th:text="|第${result.testNumber.testNumberId}回 ${result.time.time}問題 ${result.questionNumber}　　${result.koumoku.sKoumoku}|"
					class="question-meta"></p>
				<p><span class="value">問題文：[[${result.question}]]</span></p>

<!--		問題の画像あれば表示-->
				<!--			if文でデータがある場合に、パスを取ってきてイメージを表示する。-->
				<div class="image-container" th:if="${result.imagePath != null and result.imagePath != ''}">
					<img th:src="@{/images/{path}(path=${result.imagePath})}" alt="サンプル画像" />
				</div>
<!--		選択肢・答え表示-->
				<p><span class="label">あなたの選択肢：</span><span class="value" th:text="${result.userAnswer}"></span></p>
				<p><span class="label">答え：</span><span class="value" th:text="${result.correctAnswer}"></span></p>
<!--		解説のあれば表示-->
				<div class="explanation"
					th:if="${result != null and result.explanation != null and result.explanation != ''}">
					<a href="javascript:void(0);" class="toggle-explanation">解説を見る</a>
					<span class="explanation-content">[[${result.explanation}]]</span>
				</div>
			</div>

<!--		関連記事あれば表示-->
			<!--if文を付けて関連記事があればこのボタンを表示するように設定する予定-->
			<div th:if="${result.koumoku != null and result.koumoku.blogUrl != null and result.koumoku.blogUrl != ''}">
				<div class="related-link">
					<p class="related-link-message">\重要ポイント<br>　まとめてるよ！/</p>
					<a th:href="${result.koumoku.blogUrl}" target="_blank" rel="noopener noreferrer">
						<button class="zen-maru-gothic-regular" type="button">関連問題</button>
					</a>
				</div>
			</div>

		</div>

		<!--	 もう一度ボタン -->
		<form th:action="@{/challenge/{no}(no=${questionCount})}" method="get">
			<button id="submit-button" class="zen-maru-gothic-regular" type="submit">もう一度チャレンジ</button>
		</form>
	</main>
	<!--	トップへ戻るボタン-->
	<div th:replace="fragments/backToTop :: #back-to-top"></div>
	<div th:replace="fragments/footer :: footer"></div>

</body>

</html>